(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a1b228e2","chunk-2d21732b","chunk-2d0d780d"],{"76a9":function(e,t,r){"use strict";r.r(t),r.d(t,"crudOptions",(function(){return n}));r("be16");var a=r("22ce"),n={options:{height:"100%"},rowHandle:{width:300,custom:[{text:" 授权",type:"warning",size:"small",emit:"authz",icon:"el-icon-s-flag"}]},columns:[{title:"id",key:"id",width:70,form:{disabled:!0},sortable:!0},{title:"用户名",key:"userName",search:{disabled:!1},form:{editDisabled:!1,editTemplateHandle:function(e){e.component.disabled=!0},rules:[{required:!0,message:"请输入用户名"}],helper:"请填大于6位字母或者数字"},sortable:!0},{title:"密码",key:"password",form:{editDisabled:!1,rules:[{required:!1,message:"请输入密码"}],component:{props:{showPassword:!0}},helper:"填写则修改密码"},disabled:!0,sortable:!0},{title:"状态",key:"status",type:"select",form:{rules:[{required:!0,message:"请选择是否启用"}],component:{props:{filterable:!0,multiple:!1,clearable:!0}}},dict:{data:[{value:1,label:"启用"},{value:2,label:"禁用"},{value:0,label:"未知"}]},search:{disabled:!1},sortable:!0},{title:"角色",key:"roles",type:"select",width:250,dict:{url:"/user/v1/role/list",value:"id",label:"name",getData:function(e,t){return Object(a["b"])({url:e}).then((function(e){return e.data}))}},search:{disabled:!0},form:{disabled:!0},sortable:!0},{title:"创建时间",key:"createdAt",type:"datetime",width:140,form:{disabled:!0},sortable:!0},{title:"修改时间",key:"updatedAt",type:"datetime",width:140,form:{disabled:!0},sortable:!0},{title:"删除时间",key:"deletededAt",type:"datetime",width:140,form:{disabled:!0},sortable:!0}]}},a305:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("d2-container",{class:{"page-compact":e.crud.pageOptions.compact}},[r("template",{slot:"header"},[e._v(" 用户管理 "),r("example-helper",{attrs:{title:"权限管理帮助"}},[r("div",[r("link-button",{attrs:{href:"http://greper.gitee.io/d2-crud-plus/guide/permission.html"}},[e._v("权限管理帮助文档")])],1)])],1),r("d2-crud-x",{ref:"d2Crud",attrs:{columns:e.crud.columns,data:e.crud.list,rowHandle:e.crud.rowHandle,"edit-title":"修改用户信息","add-template":e.crud.addTemplate,"add-rules":e.crud.addRules,"edit-template":e.crud.editTemplate,"edit-rules":e.crud.editRules,"form-options":e.crud.formOptions,options:e.crud.options,pagination:e.crud.pagination},on:{"pagination-change":e.handlePaginationChange,"dialog-open":e.handleDialogOpen,"row-edit":e.handleRowEdit,"row-add":e.handleRowAdd,"row-remove":e.handleRowRemove,"dialog-cancel":e.handleDialogCancel,"form-data-change":e.handleFormDataChange,authz:e.authzHandle}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("crud-search",{ref:"search",attrs:{options:e.crud.searchOptions},on:{submit:e.handleSearch}}),r("el-button",{staticClass:"d2-mb-5",attrs:{slot:"header",size:"small",type:"primary"},on:{click:e.addRow},slot:"header"},[r("i",{staticClass:"el-icon-plus"}),e._v(" 新增")]),r("crud-toolbar",{attrs:{search:e.crud.searchOptions.show,compact:e.crud.pageOptions.compact,columns:e.crud.columns},on:{"update:search":function(t){return e.$set(e.crud.searchOptions,"show",t)},"update:compact":function(t){return e.$set(e.crud.pageOptions,"compact",t)},refresh:function(t){return e.doRefresh()},"columns-filter-changed":e.handleColumnsFilterChanged}})],1)]),r("el-dialog",{attrs:{title:"授予角色",visible:e.dialogPermissionVisible},on:{"update:visible":function(t){e.dialogPermissionVisible=t}}},[r("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.roleList,(function(t){return r("el-collapse-item",{key:t.platform.id,attrs:{title:t.platform.name,name:t.platform.id}},[r("el-checkbox-group",{model:{value:t.checked,callback:function(r){e.$set(t,"checked",r)},expression:"group.checked"}},e._l(t.roles,(function(t){return r("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])})),1)],1)})),1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updatePermession(e.currentUserId)}}},[e._v("确定 ")])],1)],1)],2)},n=[],o=(r("a4d3"),r("e01a"),r("d28b"),r("99af"),r("4de4"),r("c975"),r("d81d"),r("a434"),r("d3b7"),r("3ca3"),r("159b"),r("ddb0"),r("76a9")),i=r("1fbf"),d=r("c668"),l={name:"User",mixins:[i["d2CrudPlus"].crud],data:function(){return{activeNames:[],roleList:[],checked:[],dialogPermissionVisible:!1,currentUserId:void 0}},methods:{getCrudOptions:function(){return o["crudOptions"]},pageRequest:function(e){return Object(d["GetList"])(e)},addRequest:function(e){return Object(d["AddObj"])(e)},updateRequest:function(e){return Object(d["UpdateObj"])(e)},delRequest:function(e){return Object(d["DelObj"])(e.id)},infoRequest:function(e){return Object(d["GetObj"])(e.id)},authzHandle:function(e){var t=this;console.log("authz",e),Object(d["GetRoleList"])().then((function(r){var a=r.data,n=e.row.roles;null==n&&(n=[]),t.activeNames.splice(0,t.activeNames.length),a.forEach((function(e){e.checked=e.roles.map((function(e){return e.id})).filter((function(e){return n.indexOf(e)>=0})),t.activeNames.push(e.platform.id),console.log("checked",e.checked)})),t.$set(t,"roleList",a),t.currentUserId=e.row.id,t.dialogPermissionVisible=!0}))},updatePermession:function(e){var t=this,r=[],a=!0,n=!1,o=void 0;try{for(var i,l=this.roleList[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var s=i.value;r=r.concat(s.checked)}}catch(c){n=!0,o=c}finally{try{a||null==l.return||l.return()}finally{if(n)throw o}}Object(d["DoAuthz"])(e,r).then((function(e){t.dialogPermissionVisible=!1,t.doRefresh()}))}}},s=l,c=r("2877"),u=Object(c["a"])(s,a,n,!1,null,null,null);t["default"]=u.exports},c668:function(e,t,r){"use strict";r.r(t),r.d(t,"GetList",(function(){return d})),r.d(t,"AddObj",(function(){return l})),r.d(t,"UpdateObj",(function(){return s})),r.d(t,"DelObj",(function(){return c})),r.d(t,"GetObj",(function(){return u})),r.d(t,"GetRoleList",(function(){return p})),r.d(t,"DoAuthz",(function(){return m}));var a=r("22ce"),n="/user/v1/user",o="/user/v1/role",i="/user/v1/user_role";function d(e){return Object(a["b"])({url:n+"/admin",method:"get",params:e})}function l(e){return Object(a["b"])({url:n,method:"post",data:e})}function s(e){return Object(a["b"])({url:n+"/"+e.id,method:"put",data:e})}function c(e){return Object(a["b"])({url:n+"/"+e,method:"delete",params:{id:e}})}function u(e){return Object(a["b"])({url:n+"/info",method:"get",params:{id:e}})}function p(){return Object(a["b"])({url:o+"/platform/group/list",method:"get"})}function m(e,t){return Object(a["b"])({url:i+"/authz",method:"post",params:{userId:e},data:t})}}}]);