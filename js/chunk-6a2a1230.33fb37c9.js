(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6a2a1230","chunk-2d0b368a","chunk-2d219f9b","chunk-2d22bd7e","chunk-2d0c2186"],{"27f5":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dropdown",{staticStyle:{"margin-right":"10px"},on:{command:t.platformChanged}},[r("el-button",{attrs:{size:t.size,type:"primary"}},[t._v(" "+t._s(t.platformName)+" "),r("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.platformList,(function(e){return r("el-dropdown-item",{key:e.id,attrs:{command:e.id}},[t._v(t._s(e.name))])})),1)],1)},a=[],o=(r("a4d3"),r("e01a"),r("d28b"),r("b0c0"),r("a9e3"),r("d3b7"),r("3ca3"),r("ddb0"),r("96cf"),r("1fbf")),i=r("22ce"),l={name:"platform-selector",props:{value:{type:Number},size:{type:String,default:"small"}},data:function(){return{platformId:1,platformName:"",platformList:[],platformDict:{url:"/user/v1/platform/list",getData:function(t,e){return Object(i["b"])({url:t}).then((function(t){return t.data}))},value:"id",label:"name"}}},created:function(){var t;return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return null!=this.value&&(this.platformId=this.value),e.next=3,regeneratorRuntime.awrap(o["d2CrudPlus"].util.dict.get(this.platformDict));case 3:this.platformList=e.sent,t=this.getById(this.platformId,!0),null!=t&&(this.platformId=t.id,this.platformName=t.name),this.$emit("init",this.platformId);case 7:case"end":return e.stop()}}),null,this)},methods:{getById:function(t,e){if(null==this.platformList)return null;if(null!=t){var r=!0,n=!1,a=void 0;try{for(var o,i=this.platformList[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var l=o.value;if(l.id===t)return l}}catch(u){n=!0,a=u}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}}return e&&this.platformList.length>0?this.platformList[0]:void 0},platformChanged:function(t){var e=this.getById(t,!1);null!=e&&(this.platformId=e.id,this.platformName=e.name,this.$emit("change",e.id))}}},u=l,d=r("2877"),s=Object(d["a"])(u,n,a,!1,null,null,null);e["default"]=s.exports},"499d":function(t,e,r){"use strict";r.r(e),r.d(e,"crudOptions",(function(){return n}));r("b0c0");var n=function(t){return{options:{height:"100%"},rowHandle:{width:300,custom:[{text:" 授权",type:"warning",size:"small",emit:"authz",icon:"el-icon-s-flag"}]},columns:[{title:"id",key:"id",sortable:!0,width:100,form:{disabled:!0}},{title:"角色名称",key:"name",sortable:!0},{title:"角色代码",key:"code",search:{disabled:!1},form:{editTemplateHandle:function(t){t.component.disabled=!0}},sortable:!0},{title:"父角色id",key:"parentId",sortable:!0},{title:"所属平台",key:"platformId",type:"select",search:{disabled:!0},dict:{url:"/user/v1/platform/list",value:"id",label:"name"},form:{editTemplateHandle:function(t){t.component.disabled=!0},valueChange:function(e,r){console.log("-----你选择了",r,t.crud.columnsMap.platformId.component.props.dict.dataMap[r].name)}},sortable:!0},{title:"创建时间",key:"createdAt",sortable:!0,type:"datetime",form:{disabled:!0}},{title:"更新时间",key:"updatedAt",sortable:!0,type:"datetime",form:{disabled:!0}},{title:"删除时间",key:"deletedAt",sortable:!0,type:"datetime",form:{disabled:!0}}]}}},"9e04":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("d2-container",{class:{"page-compact":t.crud.pageOptions.compact}},[r("template",{slot:"header"},[t._v("角色管理 "),r("example-helper",{attrs:{title:"权限管理帮助"}},[r("div",[r("link-button",{attrs:{href:"http://greper.gitee.io/d2-crud-plus/guide/permission.html"}},[t._v("权限管理帮助文档")])],1)])],1),r("d2-crud-x",{ref:"d2Crud",attrs:{size:"mini",columns:t.crud.columns,data:t.crud.list,rowHandle:t.crud.rowHandle,"edit-title":"修改","add-template":t.crud.addTemplate,"add-rules":t.crud.addRules,"edit-template":t.crud.editTemplate,"edit-rules":t.crud.editRules,"form-options":t.crud.formOptions,options:t.crud.options,pagination:t.crud.pagination},on:{"pagination-change":t.handlePaginationChange,"dialog-open":t.handleDialogOpen,"row-edit":t.handleRowEdit,"row-add":t.handleRowAdd,"row-remove":t.handleRowRemove,"dialog-cancel":t.handleDialogCancel,"form-data-change":t.handleFormDataChange,authz:t.authzHandle}},[r("div",{staticClass:"d2-mb-5",attrs:{slot:"header"},slot:"header"}),r("div",{attrs:{slot:"header"},slot:"header"},[r("crud-search",{ref:"search",attrs:{options:t.crud.searchOptions},on:{submit:t.handleSearch}}),r("platform-selector",{attrs:{size:"small"},on:{change:t.platformChanged,init:t.platformInit}}),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"p:role:create",expression:"'p:role:create'"}],attrs:{size:"small",type:"primary"},on:{click:t.addRow}},[r("i",{staticClass:"el-icon-plus"}),t._v(" 新增")]),r("crud-toolbar",{attrs:{search:t.crud.searchOptions.show,compact:t.crud.pageOptions.compact,columns:t.crud.columns},on:{"update:search":function(e){return t.$set(t.crud.searchOptions,"show",e)},"update:compact":function(e){return t.$set(t.crud.pageOptions,"compact",e)},refresh:function(e){return t.doRefresh()},"columns-filter-changed":t.handleColumnsFilterChanged}})],1)]),r("el-dialog",{attrs:{title:"分配权限",visible:t.dialogPermissionVisible},on:{"update:visible":function(e){t.dialogPermissionVisible=e}}},[r("el-tree",{ref:"menuTree",staticClass:"filter-tree",attrs:{data:t.treeData,"default-checked-keys":t.checkedKeys,"check-strictly":!1,"node-key":"id","highlight-current":"",props:{label:"title",value:"id"},"show-checkbox":"","default-expand-all":""}}),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updatePermession(t.roleId)}}},[t._v("更 新 ")])],1)],1)],2)},a=[],o=(r("99af"),r("c975"),r("499d")),i=r("1fbf"),l=r("f163"),u=r("ba17"),d=r("27f5"),s=(r("aa6f"),{name:"Role",mixins:[i["d2CrudPlus"].crud],components:{PlatformSelector:d["default"]},data:function(){return{platformId:1,dsScopeData:[],treeData:[],checkedKeys:[],checkedDsScope:[],menuIds:"",list:[],listLoading:!0,form:{},roleId:void 0,rolesOptions:void 0,dialogPermissionVisible:!1}},methods:{initAfter:function(){this.hasPermissions("p:role:edit")||(this.crud.rowHandle.edit.disabled=!0),this.hasPermissions("p:role:del")||(this.crud.rowHandle.remove.disabled=!0),this.hasPermissions("p:role:authz")||(this.crud.rowHandle.custom[0].disabled=!0)},doLoad:function(){},getCrudOptions:function(){return Object(o["crudOptions"])(this)},pageRequest:function(t){return Object(l["GetList"])(t)},addRequest:function(t){return Object(l["AddObj"])(t)},updateRequest:function(t){return Object(l["UpdateObj"])(t)},delRequest:function(t){return Object(l["DelObj"])(t.id)},platformInit:function(t){this.platformId=t,this.getSearch().setForm({platformId:t},!0),this.getSearch().doSearch()},platformChanged:function(t){this.platformInit(t)},getAllCheckedLeafNodeId:function(t,e,r){for(var n=0;n<t.length;n++){var a=t[n];a.children&&0!==a.children.length?this.getAllCheckedLeafNodeId(a.children,e,r):-1!==e.indexOf(a.id)&&r.push(a.id)}return r},authzHandle:function(t){var e=this;console.log("authz",t),Object(u["GetTree"])({platformId:this.platformId}).then((function(r){return e.$set(e,"treeData",r.data),e.$set(e,"checkedKeys",[]),e.roleId=t.row.id,e.updateChecked(t.row.id)})).then((function(){e.dialogPermissionVisible=!0}))},updateChecked:function(t){var e=this;return Object(l["GetPermission"])(t).then((function(t){for(var r=[],n=t.data,a=0;a<n.length;a++)r.push(n[a].resourceId);r=e.getAllCheckedLeafNodeId(e.treeData,r,[]),console.log("all leaf ",r),e.$set(e,"checkedKeys",r)}))},updatePermession:function(t){var e=this;this.menuIds=this.$refs.menuTree.getCheckedKeys().concat(this.$refs.menuTree.getHalfCheckedKeys()),Object(l["DoAuthz"])(t,this.menuIds).then((function(){e.dialogPermissionVisible=!1,e.updateChecked(t)}))}}}),c=s,f=r("2877"),p=Object(f["a"])(c,n,a,!1,null,null,null);e["default"]=p.exports},aa6f:function(t,e){var r=9007199254740991,n="[object Arguments]",a="[object Function]",o="[object GeneratorFunction]",i=/^(?:0|[1-9]\d*)$/;function l(t,e){var r=-1,n=t?t.length:0;while(++r<n)if(!1===e(t[r],r,t))break;return t}function u(t,e){var r=-1,n=Array(t);while(++r<t)n[r]=e(r);return n}function d(t,e){return function(r){return t(e(r))}}var s=Object.prototype,c=s.hasOwnProperty,f=s.toString,p=s.propertyIsEnumerable,h=d(Object.keys,Object);function m(t,e){var r=A(t)||C(t)?u(t.length,String):[],n=r.length,a=!!n;for(var o in t)!e&&!c.call(t,o)||a&&("length"==o||w(o,n))||r.push(o);return r}var b=O(v),g=j();function v(t,e){return t&&g(t,e,_)}function y(t){if(!k(t))return h(t);var e=[];for(var r in Object(t))c.call(t,r)&&"constructor"!=r&&e.push(r);return e}function O(t,e){return function(r,n){if(null==r)return r;if(!D(r))return t(r,n);var a=r.length,o=e?a:-1,i=Object(r);while(e?o--:++o<a)if(!1===n(i[o],o,i))break;return r}}function j(t){return function(e,r,n){var a=-1,o=Object(e),i=n(e),l=i.length;while(l--){var u=i[t?l:++a];if(!1===r(o[u],u,o))break}return e}}function w(t,e){return e=null==e?r:e,!!e&&("number"==typeof t||i.test(t))&&t>-1&&t%1==0&&t<e}function k(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||s;return t===r}function I(t,e){var r=A(t)?l:b;return r(t,"function"==typeof e?e:S)}function C(t){return P(t)&&c.call(t,"callee")&&(!p.call(t,"callee")||f.call(t)==n)}var A=Array.isArray;function D(t){return null!=t&&x(t.length)&&!z(t)}function P(t){return R(t)&&D(t)}function z(t){var e=L(t)?f.call(t):"";return e==a||e==o}function x(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}function L(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function R(t){return!!t&&"object"==typeof t}function _(t){return D(t)?m(t):y(t)}function S(t){return t}t.exports=I},ba17:function(t,e,r){"use strict";r.r(e),r.d(e,"GetList",(function(){return i})),r.d(e,"GetTree",(function(){return l})),r.d(e,"AddObj",(function(){return u})),r.d(e,"UpdateObj",(function(){return d})),r.d(e,"DelObj",(function(){return s})),r.d(e,"GetObj",(function(){return c}));var n=r("22ce"),a="/user/v1/resource",o="/user/v1/permission";function i(t){return Object(n["b"])({url:a,method:"get",params:t})}function l(t){return Object(n["b"])({url:o+"/tree/list",method:"get",params:t})}function u(t){return Object(n["b"])({url:a,method:"post",data:t})}function d(t){return Object(n["b"])({url:a+"/"+t.id,method:"put",data:t})}function s(t){return Object(n["b"])({url:a+"/"+t,method:"delete",params:{id:t}})}function c(t){return Object(n["b"])({url:a+"/",method:"get",params:{id:t}})}},f163:function(t,e,r){"use strict";r.r(e),r.d(e,"GetList",(function(){return i})),r.d(e,"AddObj",(function(){return l})),r.d(e,"UpdateObj",(function(){return u})),r.d(e,"DelObj",(function(){return d})),r.d(e,"GetPermission",(function(){return s})),r.d(e,"DoAuthz",(function(){return c}));var n=r("22ce"),a="/user/v1/role",o="/user/v1/role_resource";function i(t){return Object(n["b"])({url:a,method:"get",params:t})}function l(t){return Object(n["b"])({url:a,method:"post",data:t})}function u(t){return Object(n["b"])({url:a+"/"+t.id,method:"put",data:t})}function d(t){return Object(n["b"])({url:a+"/"+t,method:"delete",params:{id:t}})}function s(t){return Object(n["b"])({url:o+"/role/permission",method:"get",params:{roleId:t}})}function c(t,e){return Object(n["b"])({url:a+"/authz",method:"post",params:{roleId:t},data:e})}}}]);