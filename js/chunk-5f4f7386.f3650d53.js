(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5f4f7386","chunk-366968e6","chunk-739aaf6a","chunk-73b19a99","chunk-2d0e1b28"],{"110b":function(e,t,o){"use strict";var n=o("9a43"),a=o.n(n);a.a},"267d":function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("d2-container",{staticClass:"page"},[o("div",{staticClass:"header d2-mb-10"},[o("el-radio-group",{on:{change:e.roomTypeChanged},model:{value:e.currentType,callback:function(t){e.currentType=t},expression:"currentType"}},[o("el-radio-button",{attrs:{type:"primary",value:null}},[e._v("全部")]),e._l(e.roomTypes,(function(t){return o("el-radio-button",{key:t.value,attrs:{type:"primary",label:t.value}},[e._v(e._s(t.label))])}))],2),o("div",{staticStyle:{float:"right"}},e._l(e.roomStatusDict.data,(function(t){return o("el-tag",{key:t.value,staticClass:"d2-ml-10",attrs:{type:t.color}},[e._v(e._s(t.label))])})),1)],1),o("d2-crud-x",{ref:"d2Crud",attrs:{columns:e.crud.columns,data:e.crud.list,rowHandle:e.crud.rowHandle,"edit-title":"修改","add-template":e.crud.addTemplate,"add-rules":e.crud.addRules,"edit-template":e.crud.editTemplate,"edit-rules":e.crud.editRules,"form-options":e.crud.formOptions,options:e.crud.options,loading:e.crud.loading,"selection-row":""},on:{"selection-change":e.handleSelectionChange,"dialog-open":e.handleDialogOpen,"row-edit":e.handleRowEdit,"row-add":e.handleRowAdd,"row-remove":e.handleRowRemove,"dialog-cancel":e.handleDialogCancel,"form-data-change":e.handleFormDataChange}},[o("template",{slot:"body"},[o("div",{staticClass:"main"},[o("el-row",{attrs:{gutter:10}},e._l(e.rooms,(function(t){return o("el-col",{key:t.room.id,staticClass:"d2-mb-10",attrs:{span:3}},[o("div",{class:"card bg-"+t.statusColor,staticStyle:{height:"120px"},attrs:{shadow:"hover"}},[o("div",{staticClass:"d2-mb-5"},[o("div",[t.room.status>2?o("el-button",{attrs:{size:"small",type:t.statusColor}},[e._v(" "+e._s(t.room.name)+"房 ")]):o("el-dropdown",{attrs:{type:"primary",size:"small"},on:{command:function(o){return e.doCheckInOper(t,o)}}},[o("el-button",{attrs:{type:"primary",size:"small"}},[e._v(" "+e._s(t.room.name)+"房"),o("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[o("el-dropdown-item",{attrs:{command:"add"}},[e._v("入住登记")]),o("el-dropdown-item",{attrs:{command:"edit"}},[e._v("调整时间")]),o("el-dropdown-item",{attrs:{command:"checkOut"}},[e._v("提前离店")]),o("el-dropdown-item",{attrs:{command:"del"}},[e._v("删除入住")])],1)],1),o("values-format",{staticStyle:{float:"right"},attrs:{dict:e.roomTypeDict},model:{value:t.room.roomType,callback:function(o){e.$set(t.room,"roomType",o)},expression:"item.room.roomType"}})],1)]),t.status>2?o("div",{staticClass:"text",staticStyle:{display:"flex"}},[3===t.status?o("div",[e._v("故障")]):e._e(),4===t.status?o("div",[e._v("停用")]):e._e()]):null!=t.checkIn?o("div",{staticClass:"text"},[o("div",[e._v("姓名："+e._s(t.checkIn.guestName))]),o("div",[e._v("手机："+e._s(t.checkIn.mobile))]),o("div",[e._v("入住："+e._s(e._f("date_dateline")(t.checkIn.checkInTime,"YYYY-MM-DD HH:mm","HH:mm")))]),o("div",[e._v("离店："+e._s(e._f("date_dateline")(t.checkIn.checkOutTime,"YYYY-MM-DD HH:mm","HH:mm")))]),o("div",[e._v("天数："+e._s(t.checkIn.dayCount)+"天")])]):e._e()])])})),1)],1)])],2)],1)},a=[],r=(o("a4d3"),o("e01a"),o("d28b"),o("d3b7"),o("3ca3"),o("ddb0"),o("2a5a")),i=o("c9e4"),c=o("1fbf"),d={name:"hotelDashboard",components:{},mixins:[i["default"]],data:function(){return{roomTypes:[],roomStatuses:{},currentType:null,rooms:[],roomTypeDict:{url:"/hotel/roomtype/options"},roomStatusDict:{url:"/hotel/dicts/RoomStatusEnum"}}},created:function(){var e=this;c["d2CrudPlus"].util.dict.get(this.roomTypeDict).then((function(t){e.roomTypes=t})),c["d2CrudPlus"].util.dict.get(this.roomStatusDict).then((function(t){console.log("roomStatusDict:",t);var o=!0,n=!1,a=void 0;try{for(var r,i=t[Symbol.iterator]();!(o=(r=i.next()).done);o=!0){var c=r.value;e.roomStatuses[c.value]=c}}catch(d){n=!0,a=d}finally{try{o||null==i.return||i.return()}finally{if(n)throw a}}e.$set(e.roomStatusDict,"data",t),e.loadData()}))},methods:{afterInit:function(){this.crud.options.hide=!0},roomTypeChanged:function(e){console.log("roomTypeChanged",e),this.currentType=e,this.loadData()},loadData:function(){var e=this;Object(r["GetRoomList"])(this.currentType).then((function(t){var o=!0,n=!1,a=void 0;try{for(var r,i=t.data[Symbol.iterator]();!(o=(r=i.next()).done);o=!0){var c=r.value,d=e.roomStatuses[c.status];c.statusColor=null!=d?d.color:""}}catch(s){n=!0,a=s}finally{try{o||null==i.return||i.return()}finally{if(n)throw a}}console.log("index rooms:",t.data,e.roomStatuses),e.$set(e,"rooms",t.data)}))},doLoad:function(){},doCheckInOper:function(e,t){"add"!==t?null!=e.checkIn?"edit"===t?this.editCheckIn(e.checkIn):"del"===t?this.delCheckIn(e.checkIn):"checkOut"===t&&this.doCheckOut(e.checkIn):this.$message.warning("该房间还没有入住信息"):this.addCheckIn(e)},addCheckIn:function(e){this.crud.addTemplate.roomId.value=e.room.id,console.log("addTemplate:",this.crud.addTemplate),this.$refs.d2Crud.handleAdd(this.crud.addTemplate)},editCheckIn:function(e){this.$refs.d2Crud.handleEdit(0,e)},delCheckIn:function(e){this.$refs.d2Crud.handleRemove(0,e)},doRefresh:function(){this.loadData()}}},s=d,l=(o("110b"),o("2877")),u=Object(l["a"])(s,n,a,!1,null,"bdee7fae",null);t["default"]=u.exports},"2a5a":function(e,t,o){"use strict";o.r(t),o.d(t,"GetRoomList",(function(){return a}));var n=o("f58c");function a(e){return Object(n["a"])({url:"/dashboard/rooms",method:"get",params:{roomType:e}})}},"7c17":function(e,t,o){"use strict";o.r(t),o.d(t,"crudOptions",(function(){return d}));var n=o("6e85"),a=o.n(n),r=o("be16");function i(e){return null==e&&(e=new Date),e.setHours(12),e.setMinutes(0),e.setSeconds(0),e}function c(e,t){e.setTime(e.getTime()+864e5*t)}var d={columns:[{title:"id",key:"id",sortable:!0,search:{disabled:!0},align:"center",width:"80",form:{addDisabled:!0,editDisabled:!0,rules:[{required:!0,message:"请输入id"}]}},{title:"添加时间",key:"createDate",sortable:!0,search:{key:"create_date",disabled:!0},align:"center",type:"datetime",width:"160",form:{addDisabled:!0,editDisabled:!0,rules:[{required:!0,message:"请输入创建时间"}]}},{title:"手机号",key:"mobileValue",sortable:!0,align:"center",search:{disabled:!1,width:"260px"},type:"phoneNumber",form:{editDisabled:!0,rules:[{required:!0,message:"请输入手机号"},{validator:r["mobileValidator"],message:"手机号不正确"}]},valueBuilder:function(e){e.mobileValue={phoneNumber:e.mobile,callingCode:e.telAreaCode}},valueResolve:function(e){null!=e.mobileValue&&(e.mobile=e.mobileValue.phoneNumber,e.telAreaCode=e.mobileValue.callingCode)}},{title:"客户姓名",key:"guestName",sortable:!0,search:{disabled:!1},form:{rules:[{required:!1,message:"请输入客户姓名"}]}},{title:"房间",key:"roomId",sortable:!0,search:{disabled:!1,component:{props:{clearable:!0}}},align:"center",type:"select",form:{editDisabled:!0,rules:[{required:!0,message:"请选择房间"}],props:{filterable:!0}},dict:{url:"/hotel/room/options"}},{title:"入住时间",key:"checkInRange",sortable:!0,width:260,type:"datetimerange",search:{disabled:!0},align:"center",form:{rules:[{required:!0,message:"请输入入住时间"}],component:{span:12,"time-arrow-control":!0,"default-time":["12:00:00","12:00:00"],"picker-options":{shortcuts:[{text:"今天一晚",onClick:function(e){var t=new Date,o=i();c(o,1),e.$emit("pick",[t,o])}},{text:"今天两晚",onClick:function(e){var t=new Date,o=i();c(o,2),e.$emit("pick",[t,o])}},{text:"今天三晚",onClick:function(e){var t=new Date,o=i();c(o,3),e.$emit("pick",[t,o])}},{text:"今天四晚",onClick:function(e){var t=new Date,o=i();c(o,4),e.$emit("pick",[t,o])}},{text:"明天一晚",onClick:function(e){var t=i(),o=i();c(t,1),c(o,2),e.$emit("pick",[t,o])}},{text:"明天两晚",onClick:function(e){var t=new Date,o=new Date;c(t,1),c(o,3),e.$emit("pick",[t,o])}},{text:"明天三晚",onClick:function(e){var t=new Date,o=new Date;c(t,1),c(o,3),e.$emit("pick",[t,o])}}]}}},formatter:function(e,t,o,n){return a()(e.checkInTime).format("YYYY-MM-DD HH:mm")+"至"+a()(e.checkOutTime).format("YYYY-MM-DD HH:mm")}},{title:"天数",key:"dayCount",sortable:!0,align:"center",search:{disabled:!0},form:{disabled:!0,rules:[{required:!0,message:"请输入天数"}]}},{title:"备注",key:"remark",columnName:"remark",sortable:!0,search:{name:"remark",disabled:!0},form:{rules:[{required:!1,message:"请输入备注"}]}}],options:{selectionRow:!0}}},"9a43":function(e,t,o){},c9e4:function(e,t,o){"use strict";o.r(t);var n=o("7c17"),a=o("f055"),r=o("1fbf");t["default"]={mixins:[r["d2CrudPlus"].crud],data:function(){return{}},created:function(){this.initColumns(),this.afterInit()},methods:{afterInit:function(){},getCrudOptions:function(){return n["crudOptions"]},addRequest:function(e){return this.beforeRequest(e),Object(a["AddObj"])(e)},updateRequest:function(e){return this.beforeRequest(e),Object(a["UpdateObj"])(e)},beforeRequest:function(e){var t=e.checkInRange;null!=t&&t.length>=2&&(e.checkInTime=t[0].getTime(),e.checkOutTime=t[1].getTime())},delRequest:function(e){return Object(a["DelObj"])(e.id)},handleDialogOpen:function(e){null!=e.row&&(e.row.checkInRange=[new Date(e.row.checkInTime),new Date(e.row.checkOutTime)])},doCheckOut:function(e){var t=this;this.$confirm("确定设置该客户离店吗？","离店",{type:"warning"}).then((function(){return Object(a["DoCheckOut"])(e.id)})).then((function(){t.doRefresh()})).catch((function(){}))}}}},f055:function(e,t,o){"use strict";o.r(t),o.d(t,"GetList",(function(){return a})),o.d(t,"AddObj",(function(){return r})),o.d(t,"UpdateObj",(function(){return i})),o.d(t,"DelObj",(function(){return c})),o.d(t,"DoCheckOut",(function(){return d}));var n=o("f58c");function a(e){return Object(n["a"])({url:"/hotel/checkin/page",method:"get",params:e})}function r(e){return Object(n["a"])({url:"/hotel/checkin/add",method:"post",data:e})}function i(e){return Object(n["a"])({url:"/hotel/checkin/update",method:"post",data:e})}function c(e){return Object(n["a"])({url:"/hotel/checkin/delete",method:"post",params:{id:e}})}function d(e){return Object(n["a"])({url:"/hotel/checkin/checkout",method:"post",params:{id:e}})}},f58c:function(e,t,o){"use strict";var n=o("22ce"),a=n["c"];t["a"]=a}}]);